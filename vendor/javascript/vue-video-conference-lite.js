import{ref as e,watch as t,computed as o,onBeforeUnmount as a,openBlock as n,createElementBlock as l,createElementVNode as i,toDisplayString as s,createVNode as c,unref as r,createCommentVNode as u,Fragment as d,renderList as v,normalizeStyle as p,normalizeClass as f,renderSlot as g,onMounted as m,withCtx as h,withDirectives as y,vModelSelect as b,nextTick as k,vShow as w,createBlock as E,createSlots as C}from"vue";import I from"vue-feather";import T from"mitt";import{useMouseInElement as A,useResizeObserver as S}from"@vueuse/core";import{UseFullscreen as D}from"@vueuse/components";var _=T();var M="";const N="meet.jit.si";var j={hosts:{domain:N,authdomain:`${N}`,muc:"conference."+M+N,focus:`focus.${N}`},serviceUrl:`wss://${N}/xmpp-websocket`,disableSimulcast:false,enableRemb:true,enableTcc:true,resolution:720,constraints:{video:{height:{ideal:720,max:720,min:180},width:{ideal:1280,max:1280,min:320}}},enableInsecureRoomNameWarning:true,externalConnectUrl:`https://${N}/http-pre-bind`,analytics:{amplitudeAPPKey:"fafdba4c3b47fe5f151060ca37f02d2f",whiteListedEvents:["conference.joined","page.reload.scheduled","rejoined","transport.stats"]},enableP2P:true,p2p:{enabled:true,enableUnifiedOnChrome:false,iceTransportPolicy:"all",preferredCodec:"H264",disabledCodec:"",backToP2PDelay:5},useStunTurn:true,useTurnUdp:false,websocket:`wss://${N}/xmpp-websocket`,clientNode:"http://jitsi.org/jitsimeet",desktopSharing:"ext",chromeExtensionId:"kglhbbefdnlheedjiejgomgmfplipfeb",desktopSharingSources:["screen","window"],googleApiApplicationClientID:"39065779381-bbhnkrgibtf4p0j9ne5vsq7bm49t1tlf.apps.googleusercontent.com",microsoftApiApplicationClientID:"00000000-0000-0000-0000-000040240063",enableCalendarIntegration:true,desktopSharingChromeExtId:"kglhbbefdnlheedjiejgomgmfplipfeb",desktopSharingChromeDisabled:false,desktopSharingChromeSources:["screen","window","tab"],desktopSharingChromeMinExtVersion:"0.2.6.2",desktopSharingFirefoxDisabled:false,useRoomAsSharedDocumentName:false,enableLipSync:false,disableRtx:false,enableScreenshotCapture:false,openBridgeChannel:"websocket",channelLastN:-1,startBitrate:"800",disableAudioLevels:false,disableSuspendVideo:true,stereo:false,forceJVB121Ratio:-1,enableTalkWhileMuted:true,enableNoAudioDetection:true,enableNoisyMicDetection:true,enableClosePage:true,disableLocalVideoFlip:true,hiddenDomain:`recorder.${N}`,dropbox:{appKey:"DROPBOX_APP_KEY"},transcribingEnabled:false,enableRecording:true,liveStreamingEnabled:true,fileRecordingsEnabled:true,fileRecordingsServiceEnabled:false,fileRecordingsServiceSharingEnabled:false,requireDisplayName:false,enableWelcomePage:true,isBrand:false,dialInNumbersUrl:"https://api.jitsi.net/phoneNumberList",dialInConfCodeUrl:"https://api.jitsi.net/conferenceMapper",dialOutCodesUrl:"https://api.jitsi.net/countrycodes",dialOutAuthUrl:"https://api.jitsi.net/authorizephone",peopleSearchUrl:"https://api.jitsi.net/directorySearch",inviteServiceUrl:"https://api.jitsi.net/conferenceInvite",inviteServiceCallFlowsUrl:"https://api.jitsi.net/conferenceinvitecallflows",peopleSearchQueryTypes:["user","conferenceRooms"],startAudioMuted:9,startVideoMuted:9,enableUserRolesBasedOnToken:false,enableLayerSuspension:false,feedbackPercentage:0,deploymentUrls:{userDocumentationURL:"https://jitsi.github.io/handbook/help"},chromeExtensionBanner:{url:"https://chrome.google.com/webstore/detail/jitsi-meetings/kglhbbefdnlheedjiejgomgmfplipfeb",chromeExtensionsInfo:[{path:"jitsi-logo-48x48.png",id:"kglhbbefdnlheedjiejgomgmfplipfeb"}]},prejoinPageEnabled:false,hepopAnalyticsUrl:"",hepopAnalyticsEvent:{product:"lib-jitsi-meet",subproduct:"meet-jit-si",name:"jitsi.page.load.failed",action:"page.load.failed",actionSubject:"page.load",type:"page.load.failed",source:"page.load",attributes:{type:"operational",source:"page.load"},server:`${N}`},deploymentInfo:{environment:"meet-jit-si",envType:"prod",releaseNumber:"735",shard:"meet-jit-si-eu-central-1a-s52",region:"eu-central-1",userRegion:"eu-central-1",crossRegion:0},rttMonitor:{enabled:false,initialDelay:3e4,getStatsInterval:1e4,analyticsInterval:6e4,stunServers:{"us-east-1":"all-us-east-1-turn.jitsi.net:443","ap-se-2":"all-ap-se-2-turn.jitsi.net:443","ap-se-1":"all-ap-se-1-turn.jitsi.net:443","us-west-2":"all-us-west-2-turn.jitsi.net:443","eu-central-1":"all-eu-central-1-turn.jitsi.net:443","eu-west-1":"all-eu-west-1-turn.jitsi.net:443"}},e2eping:{pingInterval:-1},abTesting:{},testing:{capScreenshareBitrate:1,octo:{probability:1}},logging:{defaultLogLevel:"trace","modules/RTC/TraceablePeerConnection.js":"info","modules/statistics/CallStats.js":"info","modules/xmpp/strophe.util.js":"log"}};function createTracksAndAddToRoom(e){const t=window.JitsiMeetJS||{};t.createLocalTracks({devices:["video","audio"]}).then((t=>{t.forEach((t=>{e.addTrack(t)}))})).catch((e=>{console.error("There was an error creating the local tracks:",e)}))}function createAndJoinRoom(e,t,o,a,n){const l=window.JitsiMeetJS||{};return new Promise((i=>{const s=e.initJitsiConference(t,{});s.on(l.events.conference.CONFERENCE_JOINED,(()=>{i(s)}));o&&s.setDisplayName(o);s.setSenderVideoConstraint(n);a?s.join(a):s.join()}))}function connect(e,t){const o=window.JitsiMeetJS||{};return new Promise(((a,n)=>{let l={...j};l.serviceUrl=j.serviceUrl+`?room=${e}`;for(const[e,t]of Object.entries(j.logging))"defaultLogLevel"!==e&&o.setLogLevelById(t,e);const i=t?.length?t:null;const s=new o.JitsiConnection(null,i,l);s.addEventListener(o.events.connection.CONNECTION_ESTABLISHED,(()=>{a(s)}));s.addEventListener(o.events.connection.CONNECTION_FAILED,(e=>{n("The connection failed. - "+e)}));s.addEventListener(o.events.connection.CONNECTION_DISCONNECTED,(e=>{n("The connection disconnected. - "+e)}));s.connect()}))}const L=["4:3","16:9","1:1","1:2"];const getRatio=e=>{const t=L[e].split(":");return t[1]/t[0]};const resize=(e,t)=>{if(t){clearTimeout(t);t=null}const o=10;const a=getRatio(e);let n=document.querySelector(".Dish");if(n){let t=n.offsetWidth-2*o;let l=n.offsetHeight-2*o;let i=0;let s=1;while(s<5e3){let e=getArea(s,n,t,l,a,o);if(false===e){i=s-1;break}s++}i-=2*o;resizer(i,n,o,a,e)}};const resizer=(e,t,o,a,n)=>{for(var l=0;l<t.children.length;l++){let i=t.children[l];i.style.margin=o+"px";i.style.width=e+"px";i.style.height=e*a+"px";i.setAttribute("data-aspect",L[n])}};const getArea=(e,t,o,a,n,l)=>{let i=0;let s=0;let c=e*n+2*l;while(i<t.children.length){if(s+e>o){s=0;c=c+e*n+2*l}s=s+e+2*l;i++}return!(c>a||e>o)&&e};const loadScripts=(e=false)=>new Promise((t=>{const o=["https://code.jquery.com/jquery-3.5.1.min.js","https://meet.jit.si/libs/lib-jitsi-meet.min.js"];let a=0;const loadScript=t=>{let o=t.split("/").pop().split(".").shift();return new Promise(((n,l)=>{if(document.getElementById(o)){a++;n();e&&console.log(`Script ${o} already loaded. Skipping...`);return}const i=document.createElement("script");i.src=t;i.id=o;i.onload=()=>{a++;n();e&&console.log(`Script ${o} loaded.`)};i.onerror=()=>{l();e&&console.log(`Script ${o} failed to load.`)};document.head.appendChild(i)}))};o.forEach((e=>{loadScript(e)}));const n=setInterval((()=>{if(a===o.length){clearInterval(n);t();e&&console.log("All scripts loaded.")}}))}));const R=["id"];const x={class:"control-box"};const P=["id"];const O={key:1,class:"Dish"};const U=["id"];const V={class:"control-box"};const B=["id"];var $={__name:"AudioPlayList",props:{tracks:{type:Array,required:true},conference:{type:Object},aspect:{type:Number,default:0}},emits:["active-focus","active-blur"],setup(p,{emit:f}){const g=p;const m={getId:()=>null,isLocal:()=>true,getParticipantId:()=>null};const h=e(null);const{isOutside:y}=A(h);t(y,(()=>{f(y.value?"active-blur":"active-focus",k.value?.getId())}));const b=o((()=>g.tracks));const k=e(b.value?.find((e=>e.getParticipantId()===(g.conference?.lastDominantSpeaker??b.value[0]?.getParticipantId())))||m);const w=o((()=>k.value?.getParticipantId()));const E=e({});const C=e({});const T={USER_LEFT:e=>{if(b.value.length){const t=b.value.find((t=>t.getParticipantId()===e));if(e===t.getParticipantId()){t.detach(E.value[t.getId()]);t.detach(E.value[t.getId()+"-a"]);const e=document.getElementById(t.getId());e&&e.parentNode.remove();const o=document.getElementById(t.getId()+"-a");o&&o.parentNode.remove()}}},TRACK_MUTE_CHANGED:e=>{C.value[e.getId()]=e.isMuted()},DOMINANT_SPEAKER_CHANGED:e=>{b.value.length&&(k.value=b.value.find((t=>t.getParticipantId()===e))||m)}};
/**
 *
 * @param { String } str
 */const trimName=e=>e.substring(0,2);const ptcpnt=(e,t)=>{const o=g.conference?.getParticipantById(e.getParticipantId());return o&&true===t?o.getDisplayName()??"Guest":o};const S=t([()=>g.conference,()=>g.tracks?.length],(([e,t])=>{if(e&&t&&!k.value?.getId()){k.value=e.getLocalAudioTrack()||m;resize(g.aspect);S()}}));Object.keys(T).forEach((e=>{_.on(e,T[e])}));a((()=>{Object.keys(T).forEach((e=>{_.off(e,T[e])}))}));return(e,t)=>(n(),l("div",null,[p.conference?.participants?.size<2?(n(),l("div",{ref_key:"scenery",ref:h,class:"Screen",key:w.value},[k.value.getId()?(n(),l("div",{key:0,"data-aspect":"4:3",class:"audio-only",id:`track-${k.value.getId()}-a`},[i("div",x,[i("span",null,s(trimName(k.value.isLocal()?"Me":ptcpnt(k.value,true))),1),c(r(I),{type:"mic"+(C.value[k.value.getId()]?"-off":"")},null,8,["type"])]),k.value.isLocal()?u("v-if",true):(n(),l("audio",{key:0,autoplay:"",ref:e=>E.value[k.value.getId()+"-a"]=e,id:k.value.getId()+"-a",class:"audio-container"},null,8,P))],8,R)):u("v-if",true)])):u("v-if",true),b.value?.length&&p.conference?.participants?.size?(n(),l("div",O,[(n(true),l(d,null,v(b.value.filter((e=>e.getId()!==k.value.getId()&&p.conference?.participants?.size<2)),(e=>(n(),l("div",{"data-aspect":"4:3",class:"audio-only",id:`track-${e.getId()}`,key:e.id},[i("div",V,[i("span",null,s(trimName(e.isLocal()?"Me":ptcpnt(e,true))),1),c(r(I),{type:"mic"+(C.value[e.getId()]?"-off":"")},null,8,["type"])]),e.isLocal()?u("v-if",true):(n(),l("audio",{key:0,autoplay:"",ref_for:true,ref:t=>E.value[e.getId()]=t,id:e.getId(),class:"audio-container"},null,8,B))],8,U)))),128))])):u("v-if",true)]))}};$.__file="src/components/AudioPlayList.vue";const J={key:0,class:"con-flex con-flex-column con-loader"};var K={__name:"WaitingLoader",props:{show:{type:Boolean},color:{type:String,default:"green"},width:{type:[String,Number],default:"80px"},height:{type:[String,Number],default:"100%"},text:{type:String}},setup(t){const c=t;const r=o((()=>({width:"string"===typeof c.width?c.width:c.width+"px",height:"string"===typeof c.height?c.height:c.height+"px"})));const d=e("");let v=setInterval((()=>{3===d.value.length?d.value="":d.value+="."}),600);a((()=>{clearInterval(v)}));return(e,o)=>t.show?(n(),l("div",J,[i("div",{class:"con-ellipsis",style:p(r.value)},[i("div",{class:f(`con-bg-${t.color}`)},null,2),i("div",{class:f(`con-bg-${t.color}`)},null,2),i("div",{class:f(`con-bg-${t.color}`)},null,2),i("div",{class:f(`con-bg-${t.color}`)},null,2)],4),t.text?(n(),l("h3",{key:0,class:f(`con-text-${t.color}`)},s(t.text+d.value),3)):u("v-if",true),g(e.$slots,"button")])):u("v-if",true)}};K.__file="src/components/WaitingLoader.vue";const F={class:"con-modal-content"};const H={class:"con-modal-header",id:"modalTitle"};const G={class:"con-modal-body con-pa-md",id:"modalDescription"};var z={__name:"SceneModal",props:{modelValue:{type:Boolean},title:{Type:String}},emits:["update:modelValue"],setup(o,{emit:c}){const r=o;const d=e(0);const v=e(null);const p=e(r.modelValue);m((()=>{document.body.appendChild(v.value)}));a((()=>{document.body.removeChild(v.value)}));t((()=>p.value),(e=>{c("update:modelValue",e)}));t((()=>r.modelValue),(e=>{p.value=e}));const close=e=>{(e.target.classList.contains("con-modal")||e.target.classList.contains("con-modal-close"))&&(p.value=false)};return(e,t)=>(n(),l("div",{role:"dialog","aria-labelledby":"modalTitle","aria-describedby":"modalDescription",id:"deviceModal",class:f(["con-modal",{show:p.value}]),ref_key:"dialog",ref:v,key:d.value,onClick:close},[u(" Modal content "),i("div",F,[i("div",H,[i("span",{"aria-label":"Close modal",class:"con-modal-close",onClick:close},"×"),i("h2",null,s(o.title),1)]),i("div",G,[g(e.$slots,"default")])])],2))}};z.__file="src/components/SceneModal.vue";const q={class:"con-row con-mt-md"};const W={class:"text-grey-7",for:"company_name"};const Q={class:"con-select"};const X=["onUpdate:modelValue"];const Y=["selected","value"];var Z={__name:"DeviceSelector",props:{room:{type:Object}},emits:["configuring"],setup(t,{emit:o}){const a=t;const u=e({audioinput:[],audiooutput:[],videoinput:[]});const p=e({audioinput:"",audiooutput:"",videoinput:""});const f=e(false);const configureCall=()=>{const e=window.JitsiMeetJS||{};if(a.room){o("configuring");e.mediaDevices.enumerateDevices((e=>{u.value={};e.forEach((e=>{u.value[e.kind]?u.value[e.kind].push(e):u.value[e.kind]=[e]}));Object.keys(u.value).forEach((e=>{p.value[e]=p.value[e]||u.value[e][0].deviceId}))}))}};const changeInputOutputDevice=async(e,t)=>{const o=window.JitsiMeetJS||{};if(a.room){if("audioinput"===t||"videoinput"===t){const n="audioinput"===t?a.room.getLocalAudioTrack():a.room.getLocalVideoTrack();const l=await o.createLocalTracks({devices:[t.replace("input","")],["videoinput"===t?"cameraDeviceId":"micDeviceId"]:e});l[0]&&n&&a.room.replaceTrack(n,l[0])}else"audiooutput"===t&&o.mediaDevices.setAudioOutputDevice(e);p.value[t]=e}};configureCall();return(e,t)=>(n(),l("div",null,[g(e.$slots,"button",{configDialog:e=>f.value=true},(()=>[i("button",{class:"con-control-btn con-hover-bg",onClick:t[0]||(t[0]=e=>f.value=true)},[c(r(I),{type:"settings"})])])),c(z,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e),title:"Device Configuration"},{default:h((()=>[i("div",q,[(n(),l(d,null,v([{v:"audioinput",l:"Audio Input Device",i:"microphone"},{v:"audiooutput",l:"Audio Ouput Device",i:"headphone"},{v:"videoinput",l:"Video Source",i:"camera"}],(e=>i("div",{class:"con-col-12 con-text-left con-mt-md",key:e},[i("label",W,s(e.l),1),i("div",Q,[i("label",null,[y(i("select",{"onUpdate:modelValue":[t=>p.value[e.v]=t,t=>changeInputOutputDevice(p.value[e.v],e.v)]},[(n(true),l(d,null,v(u.value[e.v],(t=>(n(),l("option",{key:t.id,selected:t.id===p.value[e.v],value:t.deviceId},s(t.label),9,Y)))),128))],8,X),[[b,p.value[e.v]]])])])]))),64))])])),_:1},8,["modelValue"])]))}};Z.__file="src/components/DeviceSelector.vue";const ee=["id"];const te={class:"control-box"};const oe=["id"];const ae=["id"];const ne={class:"control-box"};const le=["id"];const ie=["id"];const se=["id"];var ce={__name:"MediaTrack",props:{track:{type:Object,required:true},isAudio:{type:Boolean},isActive:{type:Boolean},aspect:{type:Number,default:0}},emits:["active-focus","active-blur"],setup(d,{emit:v}){const p=d;const g=e(null);const h=e(null);const b=o((()=>!p.isAudio&&p.isActive));const E=e(null);const C=e(null);const T=o((()=>p.track?.getId()));const S=e(false);const D=e({audioMuted:false,videoMuted:false});const M=e(null);const{isOutside:N}=A(M);t(N,(()=>{v(N.value?"active-blur":"active-focus",T.value)}));const j={USER_LEFT:(e,t)=>{if(t&&e===t.getParticipantId()){t.detach(C.value);const e=document.getElementById("track-"+T.value);e&&e.parentNode.removeChild(e)}},TRACK_MUTE_CHANGED:e=>{if(e){const t=g.value?.getParticipantId()===e.getParticipantId()&&"audio"===e.type;e.getId()===T.value?D.value.videoMuted=e.isMuted():t&&(D.value.audioMuted=e.isMuted())}}};
/**
 *
 * @param { String } str
 */const trimName=e=>D.value.videoMuted?e.substring(0,2):e;const L=e(null);const init=e=>{const t=e.conference;S.value=true;if(t){h.value=t.getParticipantById(e.getParticipantId());let o;o="audio"===e.type?e:e.isLocal()?t.getLocalAudioTrack():h.value.getTracksByMediaType("audio")[0]??{};g.value=o}if(L.value){clearTimeout(L.value);L.value=null}if(e&&(!p.isAudio||!e.isLocal())){e.attach(C.value);if(!p.isAudio&&E.value){const e=E.value.getContext("2d");C.value.addEventListener("play",(t=>{const o=t.target;(function loop(){if(!o.paused&&!o.ended){e.drawImage(o,0,0);L.value=setTimeout(loop,1e3/30)}})()}),0)}}const o=setTimeout((()=>{resize(p.aspect,o)}),100)};const R=t((()=>p.track),(e=>{init(e)}));m((()=>{k().then((()=>init(p.track)))}));a((()=>{R();if(C.value){C.value.pause();C.value.srcObject=null;C.value.load()}"function"===typeof p.track.detach&&p.track.detach(C.value);Object.keys(j).forEach((e=>{_.off(e,j[e])}))}));Object.keys(j).forEach((e=>{_.on(e,j[e])}));return(e,t)=>b.value?(n(),l("div",{key:0,ref_key:"scenery",ref:M,class:"Screen ref",id:`track-${T.value}`},[i("canvas",{ref_key:"canvasRef",ref:E,class:"largeVideoBackground"},null,512),i("div",{"data-aspect":"4:3",class:f({"audio-only":!!D.value.videoMuted})},[i("div",te,[i("span",null,s(trimName(d.track.isLocal()?"Me":h.value?.getDisplayName()??"Guest")),1),c(r(I),{type:"mic"+(D.value.audioMuted?"-off":"")},null,8,["type"])]),y(i("video",{autoplay:"",ref_key:"trackRef",ref:C,id:T.value},null,8,oe),[[w,!D.value.videoMuted]])],2)],8,ee)):d.isAudio?d.track.isLocal()?u("v-if",true):(n(),l("div",{key:2,class:"audio-container",id:`track-${T.value}`},[i("audio",{autoplay:"",ref_key:"trackRef",ref:C,id:T.value},null,8,se)],8,ie)):(n(),l("div",{key:1,"data-aspect":"4:3",style:{margin:"10px","min-width":"calc(100% - 10px)",height:"147.75px"},class:f({"audio-only":!!D.value.videoMuted}),id:`track-${T.value}`},[i("div",ne,[i("span",null,s(trimName(d.track.isLocal()?"Me":h.value?.getDisplayName()??"Guest")),1),c(r(I),{type:"mic"+(D.value.audioMuted?"-off":"")},null,8,["type"])]),y(i("video",{autoplay:"",ref_key:"trackRef",ref:C,id:T.value},null,8,le),[[w,!D.value.videoMuted]])],10,ae))}};ce.__file="src/components/MediaTrack.vue";const re={key:0,class:"waiting banner z-5"};const ue={key:2,class:"Conference"};const de={key:1,class:"Dish",ref:"dishesRef"};const ve=["onClick"];const pe=["onClick"];var fe={__name:"VideoConferencing",props:{msg:String,appDomain:{type:String,default:"meet.jit.si"},roomName:{type:String,required:true,validator:e=>{const t=e.length>3&&!/\s/.test(e)&&e===e.toLowerCase();t||console.error("Room name must be at least 4 characters long, have no spaces, and contain no capital letters");return t}},userName:{type:String,validator:e=>{const t=e.length<1||!/\s/.test(e)&&e===e.toLowerCase();t||console.error("User name must have no spaces, and contain no capital letters");return t}},displayName:{type:String},roomPassword:{type:String},videoConstraints:{type:[String,Number],default:"360"},appToken:{type:String},allowVideo:{type:Boolean,default:true},allowAudio:{type:Boolean,default:true},debugLevel:{type:String,default:"ERROR"},aspect:{type:Number,default:0},alwaysShowControls:{type:Boolean,default:false},autoConnect:{type:Boolean,default:false}},emits:["error","ready","left","joined","loading","started","stopped","connected","trackAdded"],setup(o,{emit:s}){const p=o;let y=window.JitsiMeetJS||{};const b=e(null);S(b,(()=>{x.value.show&&resize(p.aspect)}));const k=e(p.alwaysShowControls);const w=e(null);const T=e(null);const A=e(null);const M=e([]);const N=e([]);const j=e(null);const L=e(null);const R=e((new Date).getTime());const x=e({loading:false,show:false,audioMuted:false,videoMuted:false});const P=p.debugLevel?(p.debugLevel||"INFO").toUpperCase():"ERROR";const addTrack=e=>{if("video"===e.getType()&&p.allowVideo){M.value.push(e);if(e.isLocal()){A.value=e;T.value=e}}else if("audio"===e.getType()&&p.allowAudio){N.value.push(e);e.isLocal()&&(w.value=e);x.value[e.getType()+"Muted"]=e.isMuted()}};const removeTrack=e=>{if("video"===e.getType()&&p.allowVideo){M.value=M.value.filter((t=>t.getId()!==e.getId()));e.getId()===A.value?.getId()&&(A.value=M.value[0]??null)}else"audio"===e.getType()&&p.allowAudio&&(N.value=N.value.filter((t=>t.getId()!==e.getId())))};const O={TRACK_ADDED:e=>{s("trackAdded",e);_.emit("TRACK_ADDED",e);addTrack(e)},TRACK_REMOVED:e=>{_.emit("TRACK_REMOVED",e);if(e.containers.length){e.containers.forEach((t=>{e.detach(t);t.parentElement.remove()}));removeTrack(e)}},DOMINANT_SPEAKER_CHANGED:e=>{_.emit("DOMINANT_SPEAKER_CHANGED",e);L.value=e;M.value.length&&(A.value=M.value.find((t=>t.getParticipantId()===e)))},USER_LEFT:e=>{s("left",e);_.emit("USER_LEFT",e);0===j.value.participants.size&&stop()},TRACK_MUTE_CHANGED:e=>{let t=setTimeout((()=>{resize(p.aspect,t)}),10);_.emit("TRACK_MUTE_CHANGED",e);[T.value?.getParticipantId(),w.value?.getParticipantId()].includes(e.getParticipantId())&&(x.value[e.type+"Muted"]=e.isMuted())}};const setName=(e,t)=>{if(!e){const t="abcdefghijklmnopqrstuvwxyz";e="";for(let o=0;o<10;o++)e+=t[Math.floor(Math.random()*t.length)]}t&&(e=e.replace(/\b\w/g,(e=>e.toUpperCase())));return e};const connectNow=()=>{const e=p.roomName;const t=setName(p.userName);connect(e,p.appToken).then((o=>{s("connected");return createAndJoinRoom(o,e,t,p.roomPassword,p.videoConstraints)})).then((e=>{j.value=e;if("DEBUG"===p.debugLevel){window.conference=e;window.JitsiMeetJS=y;Object.keys(y.events.conference).forEach((t=>{e.on(y.events.conference[t],(e=>{console.log("Conference Event",t,e)}))}))}e.setDisplayName(setName(p.displayName??p.userName,true));e.on(y.events.conference.DOMINANT_SPEAKER_CHANGED,O.DOMINANT_SPEAKER_CHANGED);e.on(y.events.conference.TRACK_REMOVED,O.TRACK_REMOVED);e.on(y.events.conference.TRACK_MUTE_CHANGED,O.TRACK_MUTE_CHANGED);e.on(y.events.conference.TRACK_ADDED,O.TRACK_ADDED);e.on(y.events.conference.USER_LEFT,O.USER_LEFT);createTracksAndAddToRoom(e);x.value.loading=false;x.value.show=true;s("joined",e);s("loading",false)})).catch((e=>{console.error(e);x.value.show=false;x.value.loading=false;s("error",e);s("loading",false)}))};const muteMe=(e="audio")=>{const t="audio"===e?w.value:T.value;t&&(t.isMuted()?t.unmute():t.mute())};const start=()=>{x.value.loading=true;s("loading",true);let e=setTimeout((()=>{connectNow();s("started");clearTimeout(e);e=null}),1e3)};const stop=()=>{U();V();if(j.value?.isJoined()){x.value.loading=true;s("loading",true);j.value.leave().then((()=>{x.value.show=false;x.value.loading=false;j.value=null;M.value=[];N.value=[];A.value=null;w.value=null;T.value=null;R.value=(new Date).getTime();s("stopped");s("loading",false)}));j.value&&Object.keys(O).forEach((e=>{j.value.off(y.events.conference[e],O[e])}))}};const U=t(k,(()=>{if(x.value.show){let e=setTimeout((()=>{resize(p.aspect,e)}),3)}}));const V=t((()=>x.value.videoMuted),(()=>{resize(p.aspect)}));const B=e(false);m((()=>{loadScripts(["DEBUG","INFO"].includes(p.debugLevel)).then((()=>{y=window.JitsiMeetJS;y.init();y.setLogLevel(y.logLevels[P]);s("ready");B.value=true;p.autoConnect&&start()}))}));a((()=>{stop()}));return(e,t)=>(n(),E(r(D),null,{default:h((({toggle:a,isFullscreen:s})=>[(n(),l("div",{class:"Scenary",key:R.value,ref_key:"scenery",ref:b},[j.value?.participants?.size||!x.value.show&&!x.value.loading?u("v-if",true):(n(),l("div",re,[c(K,{show:"",height:"30px",color:x.value.show?"blue":"brown",text:x.value.show?"Waiting for others to join":"Connecting"},C({_:2},[x.value.show?{name:"button",fn:h((()=>[i("button",{class:"con-control-btn con-hover-bg con-text-red",onClick:stop},[c(r(I),{type:"phone-off"})])])),key:"0"}:void 0]),1032,["color","text"])])),o.allowVideo?(n(),l("div",ue,[u(" Screen Here "),A.value&&j.value?.participants?.size<2?(n(),E(ce,{"is-active":"",key:A.value.getId(),track:A.value,onActiveBlur:t[2]||(t[2]=e=>k.value=false),onActiveFocus:t[3]||(t[3]=e=>k.value=true)},null,8,["track"])):u("v-if",true),j.value?.participants?.size?(n(),l("div",de,[u(" Dishes Here "),(n(true),l(d,null,v(M.value.filter((e=>e?.getId()!==A.value?.getId()&&j.value?.participants?.size<2)),(e=>(n(),E(ce,{style:{width:"100%"},key:e.getId(),track:e},null,8,["track"])))),128))],512)):u("v-if",true)])):(n(),E($,{key:1,class:"Conference",tracks:N.value,conference:j.value,onActiveBlur:t[0]||(t[0]=e=>k.value=false),onActiveFocus:t[1]||(t[1]=e=>k.value=true)},null,8,["tracks","conference"])),g(e.$slots,"controls",{toggleFullscreen:a,activeVideoTrack:A.value,videoTracks:M.value,conference:j.value,muteMe:muteMe,tracks:{video:T.value,audio:w.value},status:x.value,start:start,stop:stop},(()=>[i("div",{class:f(["con-gap-3 con-justify-center con-control-buttons z-3",{"requires-focus":!o.alwaysShowControls,"focus-aquired":k.value||!j.value?.participants?.size}])},[x.value.show&&o.allowAudio?(n(),l("button",{key:0,class:"con-control-btn con-hover-bg",onClick:t[4]||(t[4]=e=>muteMe())},[c(r(I),{type:"mic"+(x.value.audioMuted?"-off":"")},null,8,["type"])])):u("v-if",true),x.value.show&&o.allowVideo?(n(),l("button",{key:1,class:"con-control-btn con-hover-bg",onClick:t[5]||(t[5]=e=>muteMe("video"))},[c(r(I),{type:"video"+(x.value.videoMuted?"-off":"")},null,8,["type"])])):u("v-if",true),x.value.show||!B.value||o.autoConnect&&!x.value.loading?u("v-if",true):(n(),l("button",{key:2,class:"con-control-btn con-hover-bg con-text-green",onClick:start},[c(r(I),{type:"phone"+(x.value.loading?"-call":"")},null,8,["type"])])),x.value.show?(n(),l("button",{key:3,class:"con-control-btn con-hover-bg con-text-red",onClick:stop},[c(r(I),{type:"phone-off"})])):u("v-if",true),c(K,{show:x.value.loading,color:x.value.show?"red":"green"},null,8,["show","color"]),x.value.show?(n(),l("button",{key:4,class:"con-control-btn con-hover-bg",onClick:a},[c(r(I),{type:s?"minimize":"maximize"},null,8,["type"])],8,ve)):u("v-if",true),j.value&&!s?(n(),E(Z,{key:5,room:j.value,aspect:o.aspect},{button:h((({configDialog:t})=>[g(e.$slots,"configbutton",{configDialog:t},(()=>[i("button",{class:"con-control-btn con-hover-bg",onClick:e=>t()},[c(r(I),{type:"settings"})],8,pe)]))])),_:3},8,["room","aspect"])):u("v-if",true)],2)])),u(" Audio Here "),(n(true),l(d,null,v(N.value,(e=>(n(),E(ce,{key:e.getId(),track:e,"is-audio":""},null,8,["track"])))),128))]))])),_:3}))}};fe.__file="src/components/VideoConferencing.vue";var ge={VideoConference:fe,VoiceConference:$,DeviceSelector:Z,WaitingLoader:K,MediaTrack:ce,ConModal:z};const me={install(e){for(const t in ge)if(Object.keys(ge).includes(t)){const o=ge[t];e.component(t,o)}}};const he=ge.ConModal;const ye=ge.DeviceSelector;const be=ge.MediaTrack;const ke=ge.VideoConference;const we=ge.VoiceConference;const Ee=ge.WaitingLoader;export{he as ConModal,ye as DeviceSelector,be as MediaTrack,ke as VideoConference,we as VoiceConference,Ee as WaitingLoader,me as default};

